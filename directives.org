#+BLOG: wordpress
#+POSTID: 699
#+OPTIONS: toc:3
#+DATE: [2016-07-01 Fri 10:52]
#+TITLE: Top angular directives on github
#+AUTHOR: Robert Kozikowski
#+EMAIL: r.kozikowski@gmail.com
* Introduction
All github contents recently got query-able by the Google BigQuery. See my other post about it:
https://kozikow.wordpress.com/2016/06/29/top-emacs-packages-used-in-github-repos/ .

I don't use angular recently, but my coworkers do. 
Based on our chat in a pub I decided to find out the top angular directives on github.
* Top usages in all repositories
Previous query was looking only at the sample of data.
This query looks through all files accessible on github.

#+BEGIN_SRC sql :results output
  SELECT
    TOP(line, 500),
    COUNT(*) AS c
  FROM (
    SELECT
      REGEXP_EXTRACT((SPLIT(contents.content, '\n')),
            r".*[^a-zA-Z](ng-[a-zA-Z0-9-]+).*") line,
      contents.id AS id
    FROM
      [bigquery-public-data:github_repos.contents] AS contents
    JOIN (
      SELECT
        path,
        id
      FROM
        [bigquery-public-data:github_repos.files]
      WHERE
        path LIKE '%.ng'
        OR path LIKE '%.html') AS files
    ON
      (contents.id == files.id)
    HAVING
      line CONTAINS "ng-");
#+END_SRC

[[https://docs.google.com/spreadsheets/d/1udLxsIGRGa15ICS0eDseeI5FXP7hao6e-xL6Zvrttpc/edit?usp=sharing][Full results on google docs.]]
Top 20 results:

| directive      |   count |
|----------------+---------|
| ng-click       | 1572920 |
| ng-model       | 1355222 |
| ng-show        |  962245 |
| ng-repeat      |  697010 |
| ng-if          |  601903 |
| ng-controller  |  591669 |
| ng-app         |  460875 |
| ng-class       |  452863 |
| ng-bind        |  283218 |
| ng-hide        |  217121 |
| ng-disabled    |  168468 |
| ng-include     |  125913 |
| ng-init        |  125508 |
| ng-submit      |  118507 |
| ng-switch-when |  111254 |
| ng-href        |  109513 |
| ng-src         |  108365 |
| ng-template    |  108241 |
| ng-change      |  101197 |
| ng-bind-html   |   89604 |

* Unique usage per repository in top repositories with example usage
Counting unique usage is expensive and I am out of my free quota for this month.
This query runs on a smaller table that only contains 10% random sample of files from top 130k top popular repositories.

It will calculate "how many unique repos use this directive" and add a link to an example usage. 

#+BEGIN_SRC sql :results output
  SELECT
    REGEXP_EXTRACT(line, r".*[ <]+(ng-[a-zA-Z0-9-]+).*") AS line,
    COUNT(DISTINCT(sample_repo_name)) AS count_distinct_repos,
    CONCAT("https://github.com/",
        FIRST(sample_repo_name),
        "/blob/",
        REGEXP_EXTRACT(FIRST(sample_ref), r"refs/heads/(.*)$"),
        "/",
        FIRST(sample_path)) AS example_url,
  FROM (
    SELECT
      SPLIT(content, '\n') line,
      sample_repo_name,
      sample_path,
      sample_ref
    FROM
      [bigquery-public-data:github_repos.sample_contents]
    WHERE
      (sample_path LIKE '%.html'
        OR sample_path LIKE '%.ng')
    HAVING
      line CONTAINS 'ng-')
  GROUP BY
    1
  ORDER BY
    count_distinct_repos DESC
  LIMIT
    500;
#+END_SRC

[[https://docs.google.com/spreadsheets/d/1E2AahOQiewBmJTJuB4wT6hp84zcOwx7tv7VJ4-2JyGA/edit?usp=sharing][Full results on google docs.]]
Top 20 results:

| line          | count_distinct_repos | example_url                                                                                                                                                                    |
|---------------+----------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| ng-click      |                 1040 | https://github.com/georchestra/georchestra/blob/15.12/ldapadmin/src/main/webapp/privateui/lib/angular/docs/partials/guide/dev_guide.services.injecting_controllers.html        |
| ng-repeat     |                  827 | https://github.com/claroline/Distribution/blob/master/main/core/Resources/modules/facets/Partial/panel_roles_form.html                                                         |
| ng-model      |                  823 | https://github.com/georchestra/georchestra/blob/15.12/ldapadmin/src/main/webapp/privateui/lib/angular/docs/partials/guide/dev_guide.services.injecting_controllers.html        |
| ng-show       |                  662 | https://github.com/BoxUpp/boxupp/blob/master/page/templates/vmConfigurations.html                                                                                              |
| ng-class      |                  560 | https://github.com/streamdataio/streamdataio-js/blob/master/stockmarket-angular/index.html                                                                                     |
| ng-controller |                  559 | https://github.com/georchestra/georchestra/blob/15.12/ldapadmin/src/main/webapp/privateui/lib/angular/docs/partials/guide/dev_guide.services.injecting_controllers.html        |
| ng-if         |                  536 | https://github.com/Groupmates-co/groupmates/blob/master/app/assets/javascripts/groupmates/mates/mates-tpl.html                                                                 |
| ng-app        |                  421 | https://github.com/streamdataio/streamdataio-js/blob/master/stockmarket-angular/index.html                                                                                     |
| ng-hide       |                  290 | https://github.com/BoxUpp/boxupp/blob/master/page/templates/vmConfigurations.html                                                                                              |
| ng-disabled   |                  287 | https://github.com/JekyllWriter/JekyllWriter/blob/master/layout/proxy.html                                                                                                     |
| ng-submit     |                  222 | https://github.com/Groupmates-co/groupmates/blob/master/app/assets/javascripts/groupmates/mates/mates-tpl.html                                                                 |
| ng-src        |                  211 | https://github.com/Groupmates-co/groupmates/blob/master/app/assets/javascripts/groupmates/mates/mates-tpl.html                                                                 |
| ng-include    |                  205 | https://github.com/pixelpark/ppnet/blob/master/app/views/map.html                                                                                                              |
| ng-change     |                  198 | https://github.com/mmautner/github-email-thief/blob/master/app/views/search_codes.html                                                                                         |
| ng-href       |                  187 | https://github.com/asm-products/octobox/blob/master/public/views/content/file/modal.html                                                                                       |
| ng-bind       |                  173 | https://github.com/BoxUpp/boxupp/blob/master/page/templates/vmConfigurations.html                                                                                              |
| ng-bind-html  |                  150 | https://github.com/LeoLombardi/tos-laimas-compass/blob/master/tos-laimas-compass-win32-x64/resources/app/node_modules/ui-select/docs/examples/demo-select2-with-bootstrap.html |
| ng-init       |                  146 | https://github.com/asm-products/octobox/blob/master/public/views/content/file/modal.html                                                                                       |
| ng-view       |                  145 | https://github.com/TheWildHorse/MovieNight/blob/master/public/index.html                                                                                                       |
| ng-options    |                  142 | https://github.com/mmautner/github-email-thief/blob/master/app/views/search_codes.html                                                                                         |
